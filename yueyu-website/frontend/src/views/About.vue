<template>
  <div class="page">
    <div class="container">
      <div class="section-title">
        <h2>å…³äºæˆ‘ä»¬</h2>
        <p>ä¸“ä¸šã€å¯é ã€é«˜æ•ˆçš„å¯¹å¤–åŠ³åŠ¡åˆä½œæœåŠ¡å•†</p>
      </div>
      
      <div class="about-content">
        <div class="about-text">
          <h3>é’å²›æ‚¦é€”å›½é™…ç»æµæŠ€æœ¯åˆä½œæœ‰é™å…¬å¸</h3>
          <p>å…¬å¸æˆç«‹äº2020å¹´1æœˆï¼Œæ˜¯ç»å›½å®¶å•†åŠ¡éƒ¨æ‰¹å‡†çš„ä»äº‹å¯¹å¤–åŠ³åŠ¡åˆä½œçš„ä¸“ä¸šå…¬å¸ã€‚å…¬å¸æ‹¥æœ‰ã€Šå¯¹å¤–åŠ³åŠ¡åˆä½œï¼ˆå¤–æ´¾åŠ³åŠ¡ï¼‰ç»è¥èµ„æ ¼è¯ä¹¦ã€‹ï¼Œè‡´åŠ›äºå‘å…¨çƒå„å›½æ´¾é£å„ç±»å·¥ç¨‹å¸ˆã€æŠ€æœ¯å·¥äººã€åŒ»æŠ¤äººå‘˜åŠæœåŠ¡äººå‘˜ã€‚</p>
          <p>è‡ªæˆç«‹ä»¥æ¥ï¼Œå…¬å¸å·²åŒæ¾³å¤§åˆ©äºšã€æ—¥æœ¬ã€æ–°åŠ å¡ã€æ–°è¥¿å…°ã€åŠ æ‹¿å¤§ã€éŸ©å›½ç­‰å›½å®¶å’Œåœ°åŒºçš„ç›¸å…³æœºæ„ã€å…¬å¸ã€åä¼šå»ºç«‹äº†é•¿æœŸç¨³å®šçš„åˆä½œå…³ç³»ã€‚</p>
          <p>å…¬å¸æ‹¥æœ‰ä¸€æ”¯ç»éªŒä¸°å¯Œã€ä¸“ä¸šç´ è´¨é«˜çš„å›¢é˜Ÿï¼Œä¸ºå¤–æ´¾äººå‘˜æä¾›å…¨æ–¹ä½çš„æœåŠ¡ï¼ŒåŒ…æ‹¬æŠ€èƒ½åŸ¹è®­ã€è¯­è¨€åŸ¹è®­ã€æ–‡åŒ–é€‚åº”æŒ‡å¯¼ã€ç­¾è¯åŠç†ã€å¢ƒå¤–å®‰ç½®ç­‰ä¸€ç«™å¼æœåŠ¡ã€‚</p>
          <div class="company-features">
            <div class="feature-item">
              <span class="feature-icon">ğŸ“‹</span>
              <div class="feature-text">
                <h4>èµ„è´¨é½å…¨</h4>
                <p>æ‹¥æœ‰å›½å®¶å•†åŠ¡éƒ¨é¢å‘çš„å¯¹å¤–åŠ³åŠ¡åˆä½œç»è¥èµ„æ ¼è¯ä¹¦</p>
              </div>
            </div>
            <div class="feature-item">
              <span class="feature-icon">ğŸ¤</span>
              <div class="feature-text">
                <h4>ç»éªŒä¸°å¯Œ</h4>
                <p>å¤šå¹´å›½é™…åŠ³åŠ¡åˆä½œç»éªŒï¼ŒæˆåŠŸæ´¾é£æ•°åƒåæŠ€æœ¯äººå‘˜</p>
              </div>
            </div>
            <div class="feature-item">
              <span class="feature-icon">ğŸŒ</span>
              <div class="feature-text">
                <h4>å…¨çƒåˆä½œ</h4>
                <p>ä¸å…¨çƒ20å¤šä¸ªå›½å®¶å’Œåœ°åŒºçš„ä¼ä¸šå»ºç«‹åˆä½œå…³ç³»</p>
              </div>
            </div>
            <div class="feature-item">
              <span class="feature-icon">âœ…</span>
              <div class="feature-text">
                <h4>æœåŠ¡ä¿éšœ</h4>
                <p>æä¾›å…¨æ–¹ä½çš„å¢ƒå¤–å°±ä¸šæœåŠ¡å’Œæ”¯æŒ</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- å…¬å¸ä½ç½®åœ°å›¾ -->
      <section class="map-section">
        <div class="section-title">
          <h2>å…¬å¸ä½ç½®</h2>
          <p>æ¬¢è¿æ¥åˆ°æˆ‘ä»¬çš„åŠå…¬å®¤ï¼Œæˆ‘ä»¬æœŸå¾…ä¸æ‚¨åˆä½œ</p>
        </div>
        <div class="map-container">
          <div class="map-info">
            <div class="info-card">
              <h3>é’å²›æ‚¦é€”å›½é™…ç»æµæŠ€æœ¯åˆä½œæœ‰é™å…¬å¸</h3>
              <div class="info-item">
                <span class="info-icon">ğŸ“</span>
                <span>å±±ä¸œçœé’å²›å¸‚å¸‚åŒ—åŒºæ•¦åŒ–è·¯379å·ä¸­é“é’å²›å¹¿åœºAåº§1522å®¤</span>
              </div>
              <div class="info-item">
                <span class="info-icon">ğŸ“</span>
                <span>0532-81978007</span>
              </div>
              <div class="info-item">
                <span class="info-icon">âœ‰ï¸</span>
                <span>syndicate_2008@yahoo.com</span>
              </div>
              <div class="info-item">
                <span class="info-icon">ğŸ•</span>
                <span>å‘¨ä¸€è‡³å‘¨äº” 9:00-18:00</span>
              </div>
            </div>
          </div>
          <div class="map-wrapper">
            <div id="amap-container" class="amap-container"></div>
          </div>
        </div>
      </section>
    </div>
  </div>
</template>

<script setup>
import { onMounted, onUnmounted, ref } from 'vue'

const mapInstance = ref(null)

// é’å²›æ‚¦é€”å…¬å¸çš„ä½ç½®
const companyLocation = {
  longitude: 120.3826,  // ç»åº¦
  latitude: 36.0671,    // çº¬åº¦
  address: 'å±±ä¸œçœé’å²›å¸‚å¸‚åŒ—åŒºæ•¦åŒ–è·¯379å·ä¸­é“é’å²›å¹¿åœºAåº§1522å®¤'
}

const initMap = () => {
  try {
    // åˆ›å»ºåœ°å›¾å®ä¾‹
    mapInstance.value = new AMap.Map('amap-container', {
      zoom: 16,
      center: [companyLocation.longitude, companyLocation.latitude],
      mapStyle: 'amap://styles/normal', // ä½¿ç”¨æ ‡å‡†æ ·å¼
      features: ['bg', 'road', 'building', 'point'],
      viewMode: '2D',
      resizeEnable: true,
      doubleClickZoom: true
    })

    // æ·»åŠ æ§ä»¶
    mapInstance.value.addControl(new AMap.Scale())
    mapInstance.value.addControl(new AMap.ToolBar({
      position: 'RB'
    }))

    // ç­‰å¾…åœ°å›¾å®Œå…¨åŠ è½½åå†æ·»åŠ æ ‡è®°
    mapInstance.value.on('complete', () => {
      console.log('åœ°å›¾åŠ è½½å®Œæˆï¼Œæ·»åŠ æ ‡è®°')
      addMarker()
    })
    
    // å¦‚æœåœ°å›¾å·²ç»åŠ è½½å®Œæˆï¼Œç›´æ¥æ·»åŠ æ ‡è®°
    if (mapInstance.value.getStatus() === 'complete') {
      addMarker()
    }

    console.log('é«˜å¾·åœ°å›¾åˆå§‹åŒ–æˆåŠŸ')

  } catch (error) {
    console.error('åœ°å›¾åˆå§‹åŒ–å¤±è´¥:', error)
    // æ˜¾ç¤ºåœ°å›¾åŠ è½½å¤±è´¥çš„æç¤º
    showMapError()
  }
}

const addMarker = () => {
  try {
    // åˆ›å»ºå…¬å¸ä½ç½®æ ‡è®°
    const marker = new AMap.Marker({
      position: [companyLocation.longitude, companyLocation.latitude],
      title: 'é’å²›æ‚¦é€”å›½é™…ç»æµæŠ€æœ¯åˆä½œæœ‰é™å…¬å¸',
      content: createMarkerContent(),
      offset: new AMap.Pixel(-15, -30)
    })

    // å°†æ ‡è®°æ·»åŠ åˆ°åœ°å›¾
    mapInstance.value.add(marker)

    // åˆ›å»ºä¿¡æ¯çª—ä½“
    const infoWindow = new AMap.InfoWindow({
      content: createInfoWindowContent(),
      offset: new AMap.Pixel(0, -30)
    })

    // ç‚¹å‡»æ ‡è®°æ—¶æ˜¾ç¤ºä¿¡æ¯çª—ä½“
    marker.on('click', () => {
      infoWindow.open(mapInstance.value, marker.getPosition())
    })

    console.log('æ ‡è®°æ·»åŠ æˆåŠŸ');

  } catch (error) {
    console.error('æ·»åŠ æ ‡è®°å¤±è´¥:', error);
  }
}

const createMarkerContent = () => {
  const div = document.createElement('div')
  div.className = 'custom-marker'
  div.innerHTML = `
    <div class="marker-icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <path fill="#e60012" d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
      </svg>
    </div>
  `
  return div
}

const createInfoWindowContent = () => {
  return `
    <div class="info-window">
      <h4>é’å²›æ‚¦é€”å›½é™…ç»æµæŠ€æœ¯åˆä½œæœ‰é™å…¬å¸</h4>
      <p>ğŸ“ ${companyLocation.address}</p>
      <p>ğŸ“ 0532-81978007</p>
      <p>âœ‰ï¸ syndicate_2008@yahoo.com</p>
      <p>ğŸ• å‘¨ä¸€è‡³å‘¨äº” 9:00-18:00</p>
    </div>
  `
}

const showMapError = () => {
  const container = document.getElementById('amap-container')
  if (container) {
    container.innerHTML = `
      <div class="map-error">
        <h3>åœ°å›¾åŠ è½½å¤±è´¥</h3>
        <p>åœ°å›¾æœåŠ¡æš‚æ—¶æ— æ³•ä½¿ç”¨ï¼Œè¯·ç›´æ¥è”ç³»ï¼š</p>
        <p>ğŸ“ ${companyLocation.address}</p>
        <p>ğŸ“ 0532-81978007</p>
      </div>
    `
  }
}

const loadAMapScript = () => {
  return new Promise((resolve, reject) => {
    if (window.AMap) {
      resolve()
      return
    }

    const script = document.createElement('script')
    script.type = 'text/javascript'
    script.src = 'https://webapi.amap.com/maps?v=2.0&key=30fd6c74d4d53149e32ec858e245c2b9&plugin=AMap.Scale,AMap.ToolBar,AMap.Marker,AMap.InfoWindow'
    script.async = true

    script.onload = () => {
      // ç­‰å¾…é«˜å¾·åœ°å›¾APIå®Œå…¨åŠ è½½
      setTimeout(() => {
        if (window.AMap) {
          resolve()
        } else {
          reject(new Error('é«˜å¾·åœ°å›¾APIåŠ è½½å¤±è´¥'))
        }
      }, 500)
    }

    script.onerror = () => {
      reject(new Error('é«˜å¾·åœ°å›¾è„šæœ¬åŠ è½½å¤±è´¥'))
    }

    document.head.appendChild(script)
  })
}

onMounted(async () => {
  try {
    // åŠ è½½é«˜å¾·åœ°å›¾è„šæœ¬
    await loadAMapScript()
    
    // åˆå§‹åŒ–åœ°å›¾
    setTimeout(() => {
      initMap()
    }, 100)
  } catch (error) {
    console.error('åœ°å›¾åŠ è½½é”™è¯¯:', error)
    showMapError()
  }
})

onUnmounted(() => {
  // æ¸…ç†åœ°å›¾å®ä¾‹
  if (mapInstance.value) {
    mapInstance.value.destroy()
    mapInstance.value = null
  }
})
</script>

<style scoped>
.page {
  padding: 60px 0;
  background-color: #fff;
}

.about-content {
  max-width: 800px;
  margin: 0 auto;
}

.about-text h3 {
  font-size: 28px;
  color: #2c3e50;
  margin-bottom: 30px;
  text-align: center;
}

.about-text p {
  font-size: 16px;
  line-height: 1.8;
  margin-bottom: 20px;
  color: #555;
}

.company-features {
  margin-top: 50px;
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 30px;
}

.feature-item {
  display: flex;
  align-items: flex-start;
  padding: 20px;
  background: #f8f9fa;
  border-radius: 8px;
}

.feature-icon {
  font-size: 32px;
  margin-right: 15px;
  margin-top: 5px;
}

.feature-text h4 {
  font-size: 18px;
  color: #2c3e50;
  margin-bottom: 8px;
}

.feature-text p {
  font-size: 14px;
  color: #666;
  line-height: 1.5;
  margin: 0;
}

@media (max-width: 768px) {
  .company-features {
    grid-template-columns: 1fr;
  }
}

/* åœ°å›¾éƒ¨åˆ†æ ·å¼ */
.map-section {
  padding: 60px 0;
  background-color: #f8f9fa;
}

.map-container {
  display: flex;
  gap: 30px;
  align-items: flex-start;
  max-width: 1200px;
  margin: 0 auto;
}

.map-info {
  flex: 1;
  min-width: 300px;
}

.map-wrapper {
  flex: 2;
  min-width: 400px;
}

.info-card {
  background: white;
  padding: 30px;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
  border-left: 4px solid #e60012;
}

.info-card h3 {
  font-size: 20px;
  color: #2c3e50;
  margin-bottom: 20px;
}

.info-item {
  display: flex;
  align-items: center;
  margin-bottom: 15px;
  gap: 10px;
}

.info-icon {
  font-size: 16px;
  width: 24px;
  text-align: center;
  flex-shrink: 0;
}

.amap-container {
  width: 100%;
  height: 450px;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
  background: #f0f0f0;
}

/* è‡ªå®šä¹‰æ ‡è®°æ ·å¼ */
.custom-marker {
  background: white;
  border-radius: 50%;
  border: 2px solid #e60012;
  padding: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  display: flex;
  align-items: center;
  justify-content: center;
}

.marker-icon {
  display: flex;
  align-items: center;
  justify-content: center;
}

/* ä¿¡æ¯çª—ä½“æ ·å¼ */
.info-window {
  padding: 15px;
  min-width: 250px;
}

.info-window h4 {
  margin: 0 0 10px 0;
  color: #2c3e50;
  font-size: 16px;
}

.info-window p {
  margin: 5px 0;
  font-size: 14px;
  color: #555;
}

/* åœ°å›¾é”™è¯¯æç¤º */
.map-error {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  padding: 40px;
  background: #f8f9fa;
  border-radius: 8px;
  text-align: center;
  color: #666;
}

.map-error h3 {
  color: #e60012;
  margin-bottom: 10px;
}

.map-error p {
  margin: 5px 0;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
  .map-container {
    flex-direction: column;
  }
  
  .map-wrapper {
    width: 100%;
    min-width: auto;
  }
  
  .amap-container {
    height: 350px;
  }
}
</style>